apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: weatherapi-se
spec:
  hosts:
    - api.weatherapi.com
  ports:
    - number: 443
      name: https
      protocol: HTTPS
  resolution: DNS
  location: MESH_EXTERNAL
#  endpoints:
#  - address: istio-egressgateway.istio-system.svc.cluster.local
#    ports:
#      http: 443
---
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: weatherapi-egressgateway
  namespace: weather
spec:
  selector:
    istio: egressgateway
  servers:
    - port:
        number: 443
        name: https
        protocol: HTTPS
      hosts:
        - "*"
      tls:
        mode: PASSTHROUGH



#apiVersion: networking.istio.io/v1alpha3
#kind: Gateway
#metadata:
#  name: api-weatherapi-com-gw
#spec:
#  selector:
#    istio: egressgateway
#  servers:
#    - port:
#        number: 443
#        name: https
#        protocol: TLS # Mark as TLS as we are passing HTTPS through.
#      hosts:
#        - api.weatherapi.com
#      tls:
#        mode: PASSTHROUGH
#---
#apiVersion: networking.istio.io/v1alpha3
#kind: VirtualService
#metadata:
#  name: api-weatherapi-com-vs
#spec:
#  hosts:
#    - api.weatherapi.com
#  gateways:
#    - api-weatherapi-com-gw
#  tls:
#    - match:
#        - port: 443
#          sniHosts:
#            - api.weatherapi.com
#      route:
#        - destination:
#            host: api.weatherapi.com-local
#---
#apiVersion: networking.istio.io/v1alpha3
#kind: ServiceEntry
#metadata:
#  name: api-weatherapi-com-local
#spec:
#  hosts:
#    - api.weatherapi.com-local
#  ports:
#    - number: 443
#      name: https
#      protocol: HTTPS
#  location: MESH_EXTERNAL
#  resolution: DNS
#  endpoints:
#    - address: api.weatherapi.com
#      ports:
#        http: 443